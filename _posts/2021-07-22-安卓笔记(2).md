---
layout: post
title: 安卓笔记(二)：Activity、
date: 2021-07-22
tags: 安卓
---

## 四、Activity相关

### 1.Activity的启动流程是怎样的？
**题目剖析**    
* 与AMS如何交互
* Activity的参数和结果如何传递
* Activity如何实例化
* Activity生命周期如何流转
* Activity的窗口如何展示
* Activity转场动画的实现机制    

#### Activity跨进程启动
可以参考这位大佬的[系列文章](http://liuwangshu.cn/framework/applicationprocess/1.html)

**跨进程**    
请求进程A（例如launcher进程，启动某一个APP）  --->>   通过AMP(AMS的代理)与AMS进行Binder通信  --->>  AMS解析Activity信息（主要就是Manifest文件里配置的信息）、处理启动参数、启动目标进程（通过Zygote）、绑定新进程  --->>   system_server通过调用ATP(目标进程B的ApplicationThread的代理)的scheduleLaunchActivity启动Activity在目标进程中（Binder通信）  --->>  ApplicationThread、ActivityThread、Activity生命周期     

Activity跨进程启动流程图        
![Activity跨进程启动流程图](/images/Activity跨进程启动流程图.png)

#### Activity进程内启动
**进程内**   
进程A  --->>  AMP  --->>  system_server进程  --->>  AMS解析信息，处理启动参数  --->>  ATP scheduleLaunchActivity --->>   进程A ApplicationThread、ActivityThread、Activity生命周期    

Activity进程内启动流程图    
![Activity进程内启动流程图](/images/Activity进程内启动.png)
两个小红圈的地方，就是可以进行插件化hook的地方

#### Activity的参数传递
跨进程通过Binder传递， Binder缓冲区 ①大小受<font color=yellow>缓冲区大小</font>限制 ②数据必须可以<font color=yellow>序列化</font>


















------------------------
